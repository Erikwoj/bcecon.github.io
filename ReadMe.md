This is forked and modified from https://github.com/kbroman and https://github.com/mbcarlos.
